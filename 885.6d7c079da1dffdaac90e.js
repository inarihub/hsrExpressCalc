"use strict";(self.webpackChunkcalculator=self.webpackChunkcalculator||[]).push([[885,221],{974:(e,t,n)=>{n.r(t),n.d(t,{default:()=>J});var s=n(893),a=n(294);const r="FsnFMGRC",l="BHYZdv6n",c="wg5y91ca",o="jEh6KE4N",i=(0,a.memo)((e=>{const t=["Damage","Crit.Dmg","Avg.Dmg"];return(0,s.jsxs)("div",{className:"A3Hfsa7r",children:[(0,s.jsxs)("div",{className:l,children:[(0,s.jsx)("p",{className:c,children:t[0]}),(0,s.jsx)("p",{className:o,children:e.result[0]})]}),(0,s.jsxs)("div",{className:l,children:[(0,s.jsx)("p",{className:c,children:t[1]}),(0,s.jsx)("p",{className:o,children:e.result[1]})]}),(0,s.jsxs)("div",{className:l,style:{borderBottom:"none"},children:[(0,s.jsx)("p",{className:c,children:t[2]}),(0,s.jsx)("p",{className:o,children:e.result[2]})]})]})}),(function(e,t){return e.result[0]===t.result[0]&&e.result[1]===t.result[1]&&e.result[2]===t.result[2]})),u="YasIwRBF";var d=n(814);const h={multiplier:"Dmg multiplier",crrate:"Crit. rate%",crdmg:"Crit.DMG%",baseatk:"Base Atk",basehp:"Base HP",basedef:"Base Def",flatatk:"Flat Atk",flathp:"Flat HP",flatdef:"Flat Def",atkIncrease:"Atk%",hpIncrease:"HP%",defIncrease:"Def%",elemIncrease:"ElementDmg%",dmgIncrease:"Dmg%",defIgnore:"Def Ignore",resPen:"Res Pen"},p={lvl:"Level",res:"Res%",def:"Defense",defReduction:"Def reduction%",resReduction:"Res reduction%",dmgTakenIncrease:"More DMG taken%",brokenMultiplier:"Is broken"};var m=n(245),f=n(843);const b=(0,a.memo)((function(e){const t=(0,d.hU)(e.statType);let n=t?parseFloat((100*e.value).toFixed(2)):e.value;const r=(0,a.useRef)(null),l=function(e){return-1!==Object.keys(h).indexOf(e)}(i=e.statType)?h[i]:function(e){return-1!==Object.keys(p).indexOf(e)}(i)?p[i]:"null",c=t?(0,s.jsx)(f.E,{}):(0,s.jsx)(a.Fragment,{}),o=t?void 0:{width:"8em"};var i;return(0,s.jsxs)("div",{className:"GmOFNj5O",children:[(0,s.jsx)("p",{children:l}),(0,s.jsxs)("div",{className:"E2vIMxre",children:[(0,s.jsx)("input",{ref:r,className:"Xkfy_Axq",style:o,onKeyDown:e=>{m.q.isValidKeyInput(e.key,t)||e.preventDefault()},onChange:n=>{const s=m.$.getValidatedStatData(n.target.value,t);n.target.value=s.valueAsString,e.changeCallback(e.statType,s.valueAsNumber)},type:"number",value:n}),c]})]})}),((e,t)=>e.value===t.value&&e.changeCallback===t.changeCallback));var g=n(177),v=n(612);const y=e=>{const t=e.char.atkType,n=e.char.srcStat,a=e.char.element,r=e.char.stats,l=e.char.buffs;let c=function(e){switch(e){case"hp":return{percent:"hpIncrease",base:"basehp",flat:"flathp"};case"atk":return{percent:"atkIncrease",base:"baseatk",flat:"flatatk"};case"def":return{percent:"defIncrease",base:"basedef",flat:"flatdef"}}}(e.char.srcStat);const o=(s,c)=>{e.onCharChanged(new v.zk(t,a,n,{...r,[s]:c},l))},i=(s,c)=>{e.onCharChanged(new v.zk(t,a,n,r,{...l,[s]:c}))};let h=[];for(const e of d.cE)h.push((0,s.jsx)("option",{value:e,children:e[0].toUpperCase()+e.substring(1)},e));let p=[];for(const e of g.d)p.push((0,s.jsx)("option",{value:e,children:e[0].toUpperCase()+e.substring(1)},e));let m=[];for(const e of g.l)m.push((0,s.jsx)("option",{value:e,children:e[0].toUpperCase()+e.substring(1)},e));return(0,s.jsxs)("div",{className:"Fw3CYGUT",children:[(0,s.jsx)("p",{className:"bE4xNV7Y",children:"Character:"}),(0,s.jsxs)("section",{className:u,children:[(0,s.jsx)("label",{htmlFor:"sourceStat",children:"Atk type:"}),(0,s.jsx)("select",{id:"sourceStat",value:t,onInput:t=>{const s=t.currentTarget.value;e.onCharChanged(new v.zk(s,a,n,r,l))},children:h})]}),(0,s.jsxs)("section",{className:u,children:[(0,s.jsx)("label",{htmlFor:"sourceStat",children:"Dmg source:"}),(0,s.jsx)("select",{id:"sourceStat",value:n,onInput:n=>{const s=n.currentTarget.value;e.onCharChanged(new v.zk(t,a,s,r,l))},children:p})]}),(0,s.jsxs)("section",{className:u,children:[(0,s.jsx)("label",{htmlFor:"elementDmgType",children:"Element:"}),(0,s.jsx)("select",{id:"elementDmgType",value:a,onInput:s=>{const a=s.currentTarget.value;e.onCharChanged(new v.zk(t,a,n,r,l))},children:m})]}),(0,s.jsxs)("p",{className:"iQdbwc3M",children:["Total ",n,": ",e.char.getCharTotalAtk()]}),(0,s.jsx)(b,{value:r[c.base],statType:c.base,changeCallback:o},"base"),(0,s.jsx)(b,{value:l[c.percent],statType:c.percent,type:"percent",changeCallback:i},"percent"),(0,s.jsx)(b,{value:l[c.flat],statType:c.flat,changeCallback:i},"flat"),(0,s.jsx)(b,{value:r.multiplier,statType:"multiplier",type:"percent",changeCallback:o},"multiplier"),(0,s.jsx)(b,{value:l.crrate,statType:"crrate",type:"percent",changeCallback:i},"crrate"),(0,s.jsx)(b,{value:l.crdmg,statType:"crdmg",type:"percent",changeCallback:i},"crdmg"),(0,s.jsx)(b,{value:l.dmgIncrease,statType:"dmgIncrease",type:"percent",changeCallback:i},"dmgIncrease"),(0,s.jsx)(b,{value:l.elemIncrease,statType:"elemIncrease",type:"percent",changeCallback:i},"elemIncrease"),(0,s.jsx)(b,{value:l.defIgnore,statType:"defIgnore",type:"percent",changeCallback:i},"defIgnore"),(0,s.jsx)(b,{value:l.resPen,statType:"resPen",type:"percent",changeCallback:i},"resPen")]})};var x=n(760);const j=e=>{const t=e.enemy.lvl,n=e.enemy.element,a=e.enemy.stats,r=e.enemy.debuffs,l=e.enemy.isBroken,c=(s,c)=>{e.onChangeCallback(new x.C8(t,n,a,{...r,[s]:c},l))};return(0,s.jsxs)("div",{className:"pv_lrO39",children:[(0,s.jsx)("p",{className:"nOoKx0bq",children:"Enemy:"}),(0,s.jsx)(b,{value:t,statType:"lvl",changeCallback:(t,s)=>{e.onChangeCallback(new x.C8(s,n,a,r,l))}},"lvl"),(0,s.jsx)(b,{value:a.res,statType:"res",type:"percent",changeCallback:(s,c)=>{e.onChangeCallback(new x.C8(t,n,{...a,[s]:c},r,l))}},"res"),(0,s.jsx)(b,{value:r.defReduction,statType:"defReduction",type:"percent",changeCallback:c},"defReduction"),(0,s.jsx)(b,{value:r.resReduction,statType:"resReduction",type:"percent",changeCallback:c},"resReduction"),(0,s.jsx)(b,{value:r.dmgTakenIncrease,statType:"dmgTakenIncrease",type:"percent",changeCallback:c},"dmgTakenIncrease"),(0,s.jsxs)("section",{className:"aMElhAzu",children:[(0,s.jsx)("label",{htmlFor:"isBrokenCheck",children:"Is enemy broken?"}),(0,s.jsx)("input",{id:"isBrokenCheck",type:"checkbox",checked:e.enemy.isBroken,onChange:s=>{var l;l=s.currentTarget.checked,e.onChangeCallback(new x.C8(t,n,a,r,l))}})]})]})};function k(e,t,n,s){return e.filter((e=>!(e.key!==t||e.atkTypeOption!==(n??e.atkTypeOption)&&"any"!==e.atkTypeOption||e.elemTypeOption!==(s??e.elemTypeOption)&&"all"!==e.elemTypeOption))).map((e=>e.value)).reduce(((e,t)=>e+t),0)}const C={dataStoreModule:"S4JsCCMW",headerSection:"EvNGSMKL",header:"BF3LQWwe",statusText:"uFyQc1uJ",saveSection:"cYnI8pBL",inputSave:"XGBjHG1u",loadSection:"ZkziKZdr",loadSectionButtons:"PW_9OVG_"},S="setups";function N(){const e=localStorage.getItem(S);if(!e)return console.log("There is no setups yet"),{};const t=JSON.parse(e);return t&&0!==Object.keys(t).length?t:(console.log("There is no setups yet"),{})}function w(e){const t=e.char,n=e.enemy;return{char:new v.zk(t.atkType,t.element,t.srcStat,t.stats,t.buffs),enemy:new x.C8(n.lvl,n.element,n.stats,n.debuffs,n.isBroken)}}function T(e){if(!e)return[];const t=[];for(const n of Object.keys(e).sort())t.push((0,s.jsx)("option",{className:C.options,children:n},n));return t}function I(e){return 0===Object.keys(e).length}const O=(0,a.memo)((e=>{const t=JSON.parse(localStorage[S]??null),[n,r]=(0,a.useState)(T(t)),l=(0,a.useRef)(null),c=(0,a.useRef)(null),o=(0,a.useRef)(null);return(0,s.jsxs)("div",{className:C.dataStoreModule,children:[(0,s.jsxs)("div",{className:C.headerSection,children:[(0,s.jsx)("p",{className:C.header,children:"Save/Load:"}),(0,s.jsx)("div",{ref:o,className:C.statusText})]}),(0,s.jsxs)("div",{className:C.saveSection,children:[(0,s.jsx)("input",{ref:l,maxLength:20,className:C.inputSave}),(0,s.jsx)("button",{onClick:()=>{const t=l.current;if(t&&""!==t.value){let n=N();const s=n[t.value]&&confirm("This name already exists. Do you want to override?"),a=!n[t.value];if(s||a){n[t.value]={char:e.char.getCharObj(),enemy:e.enemy.getEnemyObj()};const s=JSON.stringify(n);localStorage.setItem(S,s),r(T(n)),l.current.value="",o.current.textContent="Saved";const a=setTimeout((()=>{o.current.textContent="",clearTimeout(a)}),1500)}}},children:"Save"})]}),(0,s.jsxs)("div",{className:C.loadSection,children:[(0,s.jsxs)("select",{ref:c,className:C.loadSelector,disabled:0===n.length,defaultValue:"",children:[(0,s.jsx)("option",{value:"",disabled:!0,hidden:!0,children:"-select setup-"}),n]}),(0,s.jsxs)("section",{className:C.loadSectionButtons,children:[(0,s.jsx)("button",{onClick:()=>{const e=c.current;let t=N();if(!I(t)&&e.value&&""!==e.value&&confirm(`Selected setup "${e.value}" will be deleted. Are you sure?`)){delete t[e.value];const n=JSON.stringify(t);localStorage.setItem(S,n),r(T(t))}},children:"Delete"}),(0,s.jsx)("button",{onClick:()=>{const t=c.current;let n=N();if(I(n)||!t.value||""===t.value)return;const s=w(n[t.value]);s.char&&s.enemy&&e.loadCallback(s.char,s.enemy)},children:"Load"})]})]}),(0,s.jsxs)("div",{className:C.importExportSection,children:[(0,s.jsx)("button",{onClick:async e=>{let t;e.persist();try{t=await function(e=!1,t=10){const n=document.createElement("input");let s;return n.type="file",n.accept=".json",n.multiple=e,n.click(),new Promise(((e,a)=>{n.addEventListener("change",(()=>e(n.files))),n.addEventListener("cancel",(()=>e(null))),s=setTimeout((()=>{a()}),1e3*t)})).finally((()=>{n.remove(),clearTimeout(s)}))}(!1,600)}catch(e){alert(e)}if(!t||!t[0])return;let n,s=N();try{n=await(a=t[0],new Promise(((e,t)=>{const n=new FileReader;n.onloadend=t=>{const n=t.target.result;e(n)},n.onerror=e=>{t(e)},n.readAsText(a)})))}catch(e){alert(e)}var a;if(0===n.length)return void alert("There is nothing to import");let l;try{l=JSON.parse(n)}catch(e){return void alert("Wrong type of file!")}if(confirm('Do you want to SAVE all your previous setups?\n"OK" to ADD new setups, "Cancel" to CLEAR and ADD')){const e=confirm('Do you want to override setups if when conflict?\n"Cancel" to add with new names');for(const t in l){let n=t;if(!e){let e=0;for(;s[n];){if(e>999)throw new Error("Something went wrong with indexing new setup");e++,n=t.concat("(",e.toString(),")")}}s[n]=l[t]}}else{s={};for(const e in l)s[e]=l[e]}const c=JSON.stringify(s);localStorage.setItem(S,c),r(T(s))},children:"Import"}),(0,s.jsx)("button",{onClick:()=>{const e=N();if(I(e))return;const t=JSON.stringify(e);!function(e){const t=window.URL.createObjectURL(e),n=document.createElement("a");n.setAttribute("style","display: none"),n.href=t,n.download=e.name,n.click(),window.URL.revokeObjectURL(t),n.remove()}(new File([t],"setups.json",{type:"text/plain:charset=UTF-8"}))},children:"Export"}),(0,s.jsx)("button",{onClick:()=>localStorage.clear(),children:"Clear"})]})]})})),R=e=>{const[t,n]=(0,a.useState)([]),r=e=>{const s=e.currentTarget.value;if(!s)throw new Error("Invalid group type of bonus sets");t.includes(s)?n((e=>e.filter((e=>e!==s)))):n((e=>[...e,s]))},l=e.contents.map((e=>{const n=t.includes(e)?{border:"1px solid white"}:void 0;return(0,s.jsx)("button",{value:e,style:n,onClick:r,children:e[0].toUpperCase()+e.slice(1)},e)}));return(0,a.useEffect)((()=>{e.updateCallback(t)}),[t]),(0,s.jsx)("div",{className:"YomG6n9_",children:l})},B={bonusControllerContainer:"AymoXQsh",headerSection:"wnqXDxEQ",header:"ImEHLTHY",controlsPanel:"VZ3hsHL4",bonusSetList:"mkjP3Iwg",bonusSetsSection:"s378RR0r"},E={bonusSetContainer:"pxYAhcR9",headerSection:"wnGHKlpt",titles:"f3b4cpMX",group:"RlYXbXFG",header:"F4yNleMb",controlButtonsSection:"Mc8ryBNI",controlButton:"zylh9UdU",bonusesPreviewList:"K05DrzJz",bonus:"y7JHXhWu"};var D=n(203);const A=e=>{const[t,n]=(0,a.useState)(!0),[r,l]=(0,a.useState)(!0);let c=[];(0,a.useEffect)((()=>{e.hideBonusCallback({group:e.group,name:e.title},r)}),[r]);for(const t of e.set){const e=t.atkTypeOption&&"any"!==t.atkTypeOption&&"none"!==t.atkTypeOption?D.Z.en[t.atkTypeOption]:"",n=t.elemTypeOption&&"all"!==t.elemTypeOption&&"none"!=t.elemTypeOption?D.Z.en[t.elemTypeOption]:"",a=""===e&&""===n?"":`(${n} ${e})`,r=(0,d.hU)(t.key);let l=r?parseFloat((100*t.value).toFixed(2)):t.value;c.push((0,s.jsxs)("div",{className:E.bonus,children:[(0,s.jsxs)("p",{className:E.bonusDesc,children:["+",D.Z.en[t.key]," ",a,":"]}),(0,s.jsxs)("p",{className:E.bonusValue,children:[l,r?"%":""]})]},t.key+t.id+"_bonus"))}return(0,s.jsxs)("div",{className:E.bonusSetContainer,children:[(0,s.jsxs)("div",{className:E.headerSection,children:[(0,s.jsxs)("div",{className:E.titles,children:[(0,s.jsxs)("p",{className:E.group,children:[D.Z.en[e.group],e.group?.length>0?":":""]}),(0,s.jsx)("p",{className:E.header,children:e.title})]}),(0,s.jsxs)("div",{className:E.controlButtonsSection,children:[(0,s.jsx)("button",{title:"Activate or deactivate this bonus",style:r?void 0:{backgroundColor:"darkred"},className:E.controlButton,onClick:e=>l((e=>!e)),children:"👁"},"deactivateButton"),(0,s.jsx)("button",{title:"Minimize or restore details",className:E.controlButton,onClick:e=>n((e=>!e)),children:"..."},"showHideButton"),(0,s.jsx)("button",{title:"Delete this bonus",className:E.controlButton,onClick:t=>e.deleteCallback(e.group,e.title),children:"x"},"deleteButton")]})]}),t?(0,s.jsx)(a.Fragment,{}):(0,s.jsx)("div",{className:E.bonusesPreviewList,children:c})]})};var M=n(870),F=n(181);function L(e,t){return`${e}/_/${t}`}const P=e=>{const[t,n]=(0,a.useState)([]),r=(0,a.useRef)(null),l=(0,M.getBonusSetObjects)(),c=(t,n)=>{if(0===t.length||0===n.length)return;const s=new Map(e.bonusSets);s.delete(L(t,n))&&e.updateCallback(s)},o=(0,F.AA)(l,t)??[];let i=[];return e.bonusSets.forEach(((n,a)=>{const{groupName:r,name:l}=function(e){if(!e||""===e)throw new Error("Parse had been failed");const t=e.split("/_/");if(2!==t.length)throw new Error("Parse had been failed");return{groupName:t[0],name:t[1]}}(a);t&&!t.includes(r)&&0!==t.length||i.push((0,s.jsx)(A,{title:l,group:r,set:n,deleteCallback:c,hideBonusCallback:e.hideBonusCallback},a))})),(0,s.jsxs)("div",{className:B.bonusControllerContainer,children:[(0,s.jsx)("div",{className:B.headerSection,children:(0,s.jsx)("p",{className:B.header,children:"Bonuses:"})}),(0,s.jsxs)("div",{className:B.controlsPanel,children:[(0,s.jsxs)("select",{ref:r,className:B.bonusSetList,disabled:0===o.length,children:[(0,s.jsx)("option",{hidden:!0,value:"none",children:0===o.length?"-Create bonus set-":"-Select bonus sets-"},"option-none"),o]}),(0,s.jsxs)("div",{className:B.controlButtonSection,children:[(0,s.jsx)("button",{onClick:()=>{const t=r.current;if(t){const{groupName:n,value:s}=(0,F._K)(t),a=L(n,s);if(n&&s&&l.get(n)){const t=l.get(n)[s];if(t&&!e.bonusSets.get(a)){const n=new Map(e.bonusSets);n.set(a,t),e.updateCallback(n)}}}},children:"Load"}),(0,s.jsx)("button",{onClick:()=>{0!==e.bonusSets.size&&e.updateCallback(new Map)},children:"Clear"})]})]}),(0,s.jsx)(R,{contents:["weapon","teammate","relics","planars"],updateCallback:e=>{n(e)}}),(0,s.jsx)("div",{className:B.bonusSetsSection,children:i})]})},z="defaultUserSetup";let U=function(){const e=localStorage.getItem(z),t=e?JSON.parse(e):{};if(0!==Object.keys(t).length){const e=w(t);return{char:e.char??new v.zk,enemy:e.enemy??new x.C8,bonuses:new Map(t.bonuses)??new Map,inactives:t.inactives??[]}}return{char:new v.zk,enemy:new x.C8,bonuses:new Map,inactives:[]}}();const J=()=>{const[e,t]=(0,a.useState)(U.char),[n,l]=(0,a.useState)(U.enemy),[c,o]=(0,a.useState)(U.bonuses),[u,d]=(0,a.useState)(U.inactives);let h=(0,a.useRef)(e),p=(0,a.useRef)(n),m=(0,a.useRef)(c),f=(0,a.useRef)(u);function b(){const e=h.current?.getCharObj(),t=p.current?.getEnemyObj(),n=[...m.current],s=[...f.current];localStorage.setItem(z,JSON.stringify({char:e,enemy:t,bonus:n,inactives:s}))}function g(e){t((()=>e))}function v(e){l((()=>e))}(0,a.useEffect)((()=>(window.addEventListener("beforeunload",(e=>{b()})),()=>{b(),U={char:h.current,enemy:p.current,bonuses:m.current,inactives:f.current}})),[]),(0,a.useEffect)((()=>{h.current=e,p.current=n,m.current=c,f.current=u}));const x=[];c.forEach(((e,t)=>{const[n,s]=t.split("/_/");void 0===u.find((e=>e.group===n&&e.name===s))&&x.push(...e)}));const C=((e,t,n)=>{if(!e||!t||!n)return[0,0,0];const s=e.stats,a=e.buffs,r=t.stats,l=t.debuffs,c=t.isBroken?1:.9,o=k(n,`base${e.srcStat}`),i=k(n,`${e.srcStat}Increase`),u=k(n,`flat${e.srcStat}`),d=((s[`base${e.srcStat}`]+o)*(1+a[`${e.srcStat}Increase`]+i)+a[`flat${e.srcStat}`]+u)*s.multiplier,h=k(n,"dmgIncrease",e.atkType,e.element),p=k(n,"elemIncrease",e.atkType,e.element),m=1+a.dmgIncrease+a.elemIncrease+h+p,f=k(n,"defReduction"),b=k(n,"defIgnore");let g=t.stats.def*(1-(l.defReduction+f+a.defIgnore+b));g<0&&(g=0);const v=1-g/(g+200+800),y=k(n,"resPen",e.atkType,e.element),x=k(n,"resReduction",e.atkType,e.element);let j=r.res-(l.resReduction+x)-(a.resPen+y);j<-1&&(j=-1);const C=1-j,S=k(n,"dmgTakenIncrease",e.atkType,e.element),N=1+l.dmgTakenIncrease+S,w=k(n,"crrate"),T=e.buffs.crrate+w>1?1:e.buffs.crrate+w,I=k(n,"crdmg"),O=a.crdmg+I,R=Math.floor(d*m*v*C*N*c),B=Math.floor(R*(1+O));return[R,B,Math.floor(R+(B-R)*T)]})(e,n,x);return(0,s.jsx)("div",{className:"ehmjDA89",children:(0,s.jsxs)("div",{className:"amt11bt_",children:[(0,s.jsx)("div",{className:r,children:(0,s.jsx)(y,{char:e,onCharChanged:g})}),(0,s.jsxs)("div",{className:r,children:[(0,s.jsx)(j,{enemy:n,onChangeCallback:v}),(0,s.jsx)(i,{result:C}),(0,s.jsx)(O,{char:e,enemy:n,loadCallback:function(e,t){g(e),v(t)}})]}),(0,s.jsx)("div",{className:r,children:(0,s.jsx)(P,{bonusSets:c,updateCallback:function(e){o(e)},hideBonusCallback:function(e,t){d((n=>{if(t){const t=[...n],s=function(e,t){return Array.isArray(t)?t.findIndex((t=>t.group===e.group&&t.name===e.name)):(console.log("Missin array. Source: findInactiveBonusPath"),-1)}(e,u);return t.splice(s,1),t}return[...n,e]}))}})})]})})}}}]);
//# sourceMappingURL=885.6d7c079da1dffdaac90e.js.map